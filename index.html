<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FC26 Manager - Ultimate Data Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
--bg: #05070a; --card: #111418; --border: #30363d;
--accent: #238636; --blue: #58a6ff; --gold: #d4af37;
--text: #f8fafc; --muted: #8b949e; --danger: #da3633;
--purple: #8957e5;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 90px; }

#syncNotify { position: fixed; top: 70px; left: 50%; transform: translateX(-50%); background: var(--purple); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; z-index: 2000; display: none; }

#loginOverlay, #pinOverlay { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
#pinOverlay { display: none; background: rgba(5, 7, 10, 0.98); }
.login-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 400px; margin-top: 30px; }
.user-btn { background: var(--card); border: 1px solid var(--border); color: white; padding: 20px; border-radius: 15px; cursor: pointer; text-align: center; }
.pin-input { background: #000; border: 2px solid var(--border); color: var(--gold); font-size: 2rem; width: 150px; text-align: center; border-radius: 12px; margin: 20px 0; padding: 10px; }

header { background: #010409; padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; z-index:100; }
.season-badge { background: var(--gold); color: #000; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; }

.ticker-wrap { background: #010409; border-bottom: 1px solid var(--border); overflow: hidden; white-space: nowrap; padding: 5px 0; }
.ticker { display: inline-block; animation: ticker 40s linear infinite; }
.ticker-item { display: inline-block; padding: 0 20px; font-size: 0.65rem; color: var(--muted); }
@keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

nav { position: fixed; bottom: 0; left: 0; right: 0; background: #111418; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid var(--border); z-index: 1000; }
nav button { background: none; border: none; color: var(--muted); display: flex; flex-direction: column; align-items: center; font-size: 0.7rem; gap: 5px; cursor: pointer; }
nav button.active { color: var(--accent); }

main { padding: 15px; max-width: 600px; margin: auto; }
.card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; margin-bottom: 16px; position: relative; }

table { width: 100%; border-collapse: collapse; }
td { padding: 12px 2px; border-bottom: 1px solid #30363d55; font-size: 0.85rem; }
.col-center { text-align: center; }
.val-badge { background: #1e1b4b; color: var(--blue); padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 0.7rem; }

.btn-primary { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; }
.score-input { width: 45px; height: 40px; background: #000; border: 1px solid var(--border); color: white; text-align: center; border-radius: 8px; font-size: 1.1rem; }

/* MODAL IMPORT EXCLUSIF */
#importModal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:3000; padding:20px; overflow-y:auto; }
.import-container { background:var(--card); border:1px solid var(--gold); border-radius:15px; padding:20px; max-width:500px; margin:auto; }
</style>
</head>
<body>

<div id="syncNotify">Mise Ã  jour Live...</div>

<div id="importModal">
    <div class="import-container">
        <h3>ðŸ“¥ Importer une Saison (Saison 2)</h3>
        <p style="font-size:0.7rem; color:var(--muted)">Saisissez les totaux pour mettre Ã  jour le HOF.</p>
        <label style="font-size:0.7rem">Saison NÂ°</label>
        <input type="number" id="impSeasonNum" class="score-input" style="width:100%; margin-bottom:15px" placeholder="2">
        <div id="impPlayersList"></div>
        <div style="display:flex; gap:10px; margin-top:20px">
            <button class="btn-primary" onclick="confirmImport()">VALIDER ðŸ’¾</button>
            <button class="btn-primary" style="background:var(--danger)" onclick="qs('#importModal').style.display='none'">ANNULER</button>
        </div>
    </div>
</div>

<div id="loginOverlay">
<h2>FC26 ELITE</h2>
<div class="login-grid">
<div class="user-btn" style="border-color:var(--gold)" onclick="checkPin()">ADMIN</div>
<div class="user-btn" onclick="login('BVI')">BVI</div>
<div class="user-btn" onclick="login('NAD')">NAD</div>
<div class="user-btn" onclick="login('WIL')">WIL</div>
<div class="user-btn" onclick="login('BROOK')">BROOK</div>
</div>
</div>

<div id="pinOverlay">
<input type="password" id="pinCode" class="pin-input" maxlength="4">
<button class="btn-primary" onclick="validatePin()">OK</button>
</div>

<header>
<div onclick="logout()" style="cursor:pointer"><i class="fas fa-power-off"></i> <span id="userDisplay"></span></div>
<div id="seasonBadge" class="season-badge">Saison 1</div>
</header>

<div id="resultTicker" class="ticker-wrap"></div>
<main id="app"></main>

<nav>
<button class="active" data-tab="dashboard"><i class="fas fa-chart-line"></i><span>Stats</span></button>
<button data-tab="analysis"><i class="fas fa-brain"></i><span>IA</span></button>
<button data-tab="matches"><i class="fas fa-gamepad"></i><span>Jouer</span></button>
<button data-tab="players"><i class="fas fa-users"></i><span>Joueurs</span></button>
<button data-tab="hof"><i class="fas fa-crown"></i><span>H.O.F</span></button>
</nav>

<script>
const FB_URL = "https://fc26-e596e-default-rtdb.europe-west1.firebasedatabase.app/data.json";
const ADMIN_PIN = "1234";
let currentUser = localStorage.getItem("fc26_user") || null;
let state = { season: 1, players: [], currentDay: [], archives: [] };
let isInteracting = false;
const qs = (s) => document.querySelector(s);
const isAdmin = () => currentUser === 'ADMIN';

async function pushData() { if (isAdmin()) await fetch(FB_URL, { method: 'PUT', body: JSON.stringify(state) }); }
async function pullData() {
    if (isInteracting) return;
    const res = await fetch(FB_URL);
    const data = await res.json();
    if (data && JSON.stringify(data) !== JSON.stringify(state)) {
        state = data; render(); qs('#seasonBadge').innerText = `Saison ${state.season}`;
    }
}
setInterval(pullData, 5000);

function login(user) { currentUser = user; localStorage.setItem("fc26_user", user); qs('#loginOverlay').style.display = 'none'; qs('#userDisplay').innerText = user; pullData(); }
function checkPin() { qs('#pinOverlay').style.display = 'flex'; }
function validatePin() { if(qs('#pinCode').value === ADMIN_PIN) { qs('#pinOverlay').style.display='none'; login('ADMIN'); } }
function logout() { localStorage.removeItem("fc26_user"); location.reload(); }
if(currentUser) login(currentUser);

// --- MODIFICATION : IMPORTATION ---
function openImportModal() {
    isInteracting = true;
    qs('#importModal').style.display = 'block';
    qs('#impPlayersList').innerHTML = state.players.map(p => `
        <div class="card" style="margin-bottom:10px">
            <strong>${p.name}</strong>
            <div style="display:flex; gap:10px; margin-top:5px">
                <input type="number" id="imp_pts_${p.name}" placeholder="Pts" class="score-input" style="flex:1">
                <input type="number" id="imp_gf_${p.name}" placeholder="Buts" class="score-input" style="flex:1">
            </div>
        </div>
    `).join('');
}

function confirmImport() {
    const sNum = parseInt(qs('#impSeasonNum').value);
    if(!sNum) return alert("NumÃ©ro de saison requis");
    const dummy = [];
    state.players.forEach(p => {
        const pts = parseInt(qs(`#imp_pts_${p.name}`).value) || 0;
        const gf = parseInt(qs(`#imp_gf_${p.name}`).value) || 0;
        dummy.push({ p1: p.name, p2: "System", s1: gf, s2: 0, ptsStored: pts, done: true, seasonRef: sNum, date: "Import" });
    });
    if(!state.archives) state.archives = [];
    state.archives.push(dummy);
    qs('#importModal').style.display = 'none';
    isInteracting = false; pushData(); render();
}

function render() {
    const tab = qs("nav button.active").dataset.tab;
    const app = qs("#app"); app.innerHTML = "";

    if (tab === "dashboard") {
        const sorted = [...state.players].sort((a,b) => b.points - a.points);
        app.innerHTML = `<h3>Classement S${state.season}</h3><div class="card"><table>
        ${sorted.map(p => `<tr><td>${p.name}</td><td class="col-center">${p.points} pts</td><td class="col-center"><span class="val-badge">${(10+p.points).toFixed(1)}M</span></td></tr>`).join('')}
        </table></div>`;
    }
    if (tab === "matches") {
        if (!state.currentDay || state.currentDay.length === 0) {
            app.innerHTML = `<button class="btn-primary" onclick="startDay()">NOUVELLE JOURNÃ‰E</button>`;
        } else {
            app.innerHTML = state.currentDay.map((m, i) => `<div class="card">${m.p1} <input type="number" id="s1_${i}" class="score-input"> - <input type="number" id="s2_${i}" class="score-input"> ${m.p2} <button onclick="valider(${i})">OK</button></div>`).join('');
        }
    }
    if (tab === "players") {
        app.innerHTML = `<h3>Joueurs</h3>${state.players.map(p => `<div class="card">${p.name}</div>`).join('')}
        ${isAdmin() ? `<button class="btn-primary" style="background:var(--gold); color:black; margin-top:10px" onclick="openImportModal()">ðŸ“¥ IMPORTER SAISON PASSÃ‰E (Saison 2)</button>` : ''}`;
    }
    if (tab === "hof") {
        app.innerHTML = `<h3>Hall of Fame</h3><p>Les donnÃ©es importÃ©es s'affichent ici.</p>`;
    }
}

function startDay() { if(isAdmin()){ state.currentDay=[{p1:state.players[0].name, p2:state.players[1].name, s1:null, s2:null, done:false, seasonRef:state.season, date:new Date().toLocaleDateString()}]; pushData(); render(); } }
document.querySelectorAll("nav button").forEach(btn => { btn.onclick = () => { document.querySelectorAll("nav button").forEach(b=>b.classList.remove('active')); btn.classList.add('active'); render(); }; });
pullData();
</script>
</body>
</html>
