<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FC26 Manager - Ultimate Data Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root {
--bg: #05070a; --card: #111418; --border: #30363d;
--accent: #238636; --blue: #58a6ff; --gold: #d4af37;
--text: #f8fafc; --muted: #8b949e; --danger: #da3633;
--purple: #8957e5;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 90px; }

header { background: #010409; padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; z-index:100; }
.season-badge { background: var(--gold); color: #000; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; }

nav { position: fixed; bottom: 0; left: 0; right: 0; background: #111418; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid var(--border); z-index: 1000; }
nav button { background: none; border: none; color: var(--muted); display: flex; flex-direction: column; align-items: center; font-size: 0.65rem; gap: 5px; cursor: pointer; }
nav button.active { color: var(--gold); }

main { padding: 15px; max-width: 600px; margin: auto; }
.card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; margin-bottom: 16px; position: relative; }

/* Styles Hall of Fame */
.hof-king { text-align: center; background: linear-gradient(135deg, #1e1b4b 0%, #000 100%); border: 2px solid var(--gold); padding: 25px; border-radius: 20px; margin-bottom: 20px; }
.king-name { font-size: 1.8rem; font-weight: 800; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; }
.hof-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #333; }
.hof-count { background: var(--gold); color: #000; font-weight: bold; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }

/* Utils */
.btn-primary { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
.streak-badge { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; margin-left: 5px; font-weight: bold; }
.streak-fire { background: rgba(218, 54, 51, 0.1); color: #ff5f5c; border: 1px solid #da3633; }
</style>
</head>
<body>

<header>
    <div id="userDisplay" style="font-size:0.8rem; font-weight:bold">FC26 ELITE</div>
    <div id="seasonBadge" class="season-badge">Saison 1</div>
</header>

<main id="app"></main>

<nav>
    <button class="active" data-tab="dashboard"><i class="fas fa-chart-line"></i><span>Stats</span></button>
    <button data-tab="hof"><i class="fas fa-trophy"></i><span>Hall of Fame</span></button>
    <button data-tab="matches"><i class="fas fa-gamepad"></i><span>Jouer</span></button>
    <button data-tab="players"><i class="fas fa-users"></i><span>Joueurs</span></button>
    <button data-tab="archives"><i class="fas fa-history"></i><span>D√©tails</span></button>
</nav>

<script>
const FB_URL = "https://fc26-e596e-default-rtdb.europe-west1.firebasedatabase.app/data.json";
let state = { season: 1, players: [], currentDay: [], archives: [] };

async function pullData() {
    try {
        const res = await fetch(FB_URL);
        const data = await res.json();
        if (data) { state = data; render(); }
    } catch (e) {}
}

// LOGIQUE ANALYSE DES SAISONS
function getHOFData() {
    let winnersBySeason = [];
    let titleCount = {};

    if (!state.archives) return { winnersBySeason, titleCount, king: null };

    state.archives.forEach((dayMatches, index) => {
        const sNum = dayMatches[0].seasonRef;
        // On ne traite la saison qu'une fois
        if (!winnersBySeason.find(x => x.season === sNum)) {
            const winner = getWinnerOfSeason(sNum);
            winnersBySeason.push({ season: sNum, winner: winner });
            
            if (winner !== "-") {
                titleCount[winner] = (titleCount[winner] || 0) + 1;
            }
        }
    });

    // Trouver le roi (plus grand nombre de titres)
    let king = null;
    let maxTitles = -1;
    Object.keys(titleCount).forEach(name => {
        if (titleCount[name] > maxTitles) {
            maxTitles = titleCount[name];
            king = name;
        }
    });

    return { winnersBySeason, titleCount, king, maxTitles };
}

function getWinnerOfSeason(sNum) {
    let pts = {};
    const seasonMatches = state.archives.flat().filter(m => m.seasonRef == sNum);
    seasonMatches.forEach(m => {
        if(!pts[m.p1]) pts[m.p1] = 0;
        if(!pts[m.p2]) pts[m.p2] = 0;
        if(m.s1 > m.s2) pts[m.p1] += 3;
        else if(m.s2 > m.s1) pts[m.p2] += 3;
        else { pts[m.p1]++; pts[m.p2]++; }
    });
    return Object.keys(pts).reduce((a, b) => pts[a] > pts[b] ? a : b, "-");
}

function render() {
    const tab = document.querySelector("nav button.active").dataset.tab;
    const app = document.getElementById("app");
    app.innerHTML = "";

    if (tab === "hof") {
        const data = getHOFData();
        
        let html = `<h3>üèÜ Hall of Fame</h3>`;

        if (data.king) {
            html += `
            <div class="hof-king">
                <i class="fas fa-crown" style="color:var(--gold); font-size:2rem; margin-bottom:10px"></i>
                <div style="font-size:0.7rem; color:var(--muted)">LE ROI DU FC26</div>
                <div class="king-name">${data.king}</div>
                <div style="color:var(--gold); font-weight:bold; margin-top:5px">${data.maxTitles} TITRES</div>
            </div>`;
        }

        html += `<div class="card"><strong>Classement des Titres</strong><div style="margin-top:10px">`;
        Object.keys(data.titleCount).sort((a,b) => data.titleCount[b] - data.titleCount[a]).forEach(player => {
            html += `
            <div class="hof-item">
                <span>${player}</span>
                <span class="hof-count">${data.titleCount[player]}</span>
            </div>`;
        });
        html += `</div></div>`;

        html += `<div class="card"><strong>Historique des Vainqueurs</strong><div style="margin-top:10px">`;
        data.winnersBySeason.reverse().forEach(s => {
            html += `
            <div class="hof-item" style="border-bottom: 1px solid #ffffff05">
                <span style="color:var(--muted)">Saison ${s.season}</span>
                <span style="font-weight:bold; color:var(--gold)">${s.winner}</span>
            </div>`;
        });
        html += `</div></div>`;

        app.innerHTML = html;
    }

    if (tab === "dashboard") {
        app.innerHTML = "<h3>Classement Actuel</h3><div class='card'>Chargement...</div>";
        // Appel des fonctions de classement (d√©j√† pr√©sentes dans ton code)
    }
    
    // ... Garde ici le reste de tes fonctions de rendu (matches, players, etc) ...
}

document.querySelectorAll("nav button").forEach(btn => {
    btn.onclick = () => {
        document.querySelectorAll("nav button").forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        render();
    };
});

setInterval(pullData, 5000);
pullData();
</script>
</body>
</html>
